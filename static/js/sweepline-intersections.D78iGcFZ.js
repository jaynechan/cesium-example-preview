class x{constructor(t=[],n=I){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:i}=this,r=n[t];for(;t>0;){const p=t-1>>1,h=n[p];if(i(r,h)>=0)break;n[t]=h,t=p}n[t]=r}_down(t){const{data:n,compare:i}=this,r=this.length>>1,p=n[t];for(;t<r;){let h=(t<<1)+1,s=n[h];const o=h+1;if(o<this.length&&i(n[o],s)<0&&(h=o,s=n[o]),i(s,p)>=0)break;n[t]=s,t=h}n[t]=p}}function I(e,t){return e<t?-1:e>t?1:0}function g(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function P(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class v{constructor(t,n,i,r){this.p={x:t[0],y:t[1]},this.featureId=n,this.ringId=i,this.eventId=r,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function k(e,t){if(e.type==="FeatureCollection"){const n=e.features;for(let i=0;i<n.length;i++)y(n[i],t)}else y(e,t)}let u=0,a=0,E=0;function y(e,t){const n=e.type==="Feature"?e.geometry:e;let i=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(i=[i]),n.type==="LineString"&&(i=[[i]]);for(let r=0;r<i.length;r++)for(let p=0;p<i[r].length;p++){let h=i[r][p][0],s=null;a=a+1;for(let o=0;o<i[r][p].length-1;o++){s=i[r][p][o+1];const f=new v(h,u,a,E),l=new v(s,u,a,E+1);f.otherEvent=l,l.otherEvent=f,g(f,l)>0?(l.isLeftEndpoint=!0,f.isLeftEndpoint=!1):(f.isLeftEndpoint=!0,l.isLeftEndpoint=!1),t.push(f),t.push(l),h=s,E=E+1}}u=u+1}class _{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function F(e,t){if(e===null||t===null||e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,i=e.leftSweepEvent.p.y,r=e.rightSweepEvent.p.x,p=e.rightSweepEvent.p.y,h=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,o=t.rightSweepEvent.p.x,f=t.rightSweepEvent.p.y,l=(f-s)*(r-n)-(o-h)*(p-i),w=(o-h)*(i-s)-(f-s)*(n-h),S=(r-n)*(i-s)-(p-i)*(n-h);if(l===0)return!1;const c=w/l,d=S/l;if(c>=0&&c<=1&&d>=0&&d<=1){const m=n+c*(r-n),L=i+c*(p-i);return[m,L]}return!1}function b(e,t){t=t||!1;const n=[],i=new x([],P);for(;e.length;){const r=e.pop();if(r.isLeftEndpoint){const p=new _(r);for(let h=0;h<i.data.length;h++){const s=i.data[h];if(t&&s.leftSweepEvent.featureId===r.featureId)continue;const o=F(p,s);o!==!1&&n.push(o)}i.push(p)}else r.isLeftEndpoint===!1&&i.pop()}return n}function A(e,t){const n=new x([],g);return k(e,n),b(n,t)}export{A as s};
