var r=Object.prototype.hasOwnProperty;function n(r,n,t,e,o,i){3===arguments.length&&(e=i=Array,o=null);for(var a=new e(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),u=new i(r),f=r-1,c=0;c<r;++c)a[c]=o;return{set:function(e,i){for(var c=n(e)&f,l=a[c],s=0;l!=o;){if(t(l,e))return u[c]=i;if(++s>=r)throw new Error("full hashmap");l=a[c=c+1&f]}return a[c]=e,u[c]=i,i},maybeSet:function(e,i){for(var c=n(e)&f,l=a[c],s=0;l!=o;){if(t(l,e))return u[c];if(++s>=r)throw new Error("full hashmap");l=a[c=c+1&f]}return a[c]=e,u[c]=i,i},get:function(e,i){for(var c=n(e)&f,l=a[c],s=0;l!=o;){if(t(l,e))return u[c];if(++s>=r)break;l=a[c=c+1&f]}return i},keys:function(){for(var r=[],n=0,t=a.length;n<t;++n){var e=a[n];e!=o&&r.push(e)}return r}}}function t(r,n){return r[0]===n[0]&&r[1]===n[1]}var e=new ArrayBuffer(16),o=new Float64Array(e),i=new Uint32Array(e);function a(r){o[0]=r[0],o[1]=r[1];var n=i[0]^i[1];return 2147483647&(n=n<<5^n>>7^i[2]^i[3])}function u(r){var e,o,i,u,f=r.coordinates,c=r.lines,l=r.rings,s=function(){for(var r=n(1.4*f.length,E,P,Int32Array,-1,Int32Array),t=new Int32Array(f.length),e=0,o=f.length;e<o;++e)t[e]=r.maybeSet(e,e);return t}(),h=new Int32Array(f.length),v=new Int32Array(f.length),g=new Int32Array(f.length),p=new Int8Array(f.length),y=0;for(e=0,o=f.length;e<o;++e)h[e]=v[e]=g[e]=-1;for(e=0,o=c.length;e<o;++e){var d=c[e],m=d[0],b=d[1];for(i=s[m],u=s[++m],++y,p[i]=1;++m<=b;)A(e,i,i=u,u=s[m]);++y,p[u]=1}for(e=0,o=f.length;e<o;++e)h[e]=-1;for(e=0,o=l.length;e<o;++e){var w=l[e],x=w[0]+1,M=w[1];for(A(e,s[M-1],i=s[x-1],u=s[x]);++x<=M;)A(e,i,i=u,u=s[x])}function A(r,n,t,e){if(h[t]!==r){h[t]=r;var o=v[t];if(o>=0){var i=g[t];o===n&&i===e||o===e&&i===n||(++y,p[t]=1)}else v[t]=n,g[t]=e}}function E(r){return a(f[r])}function P(r,n){return t(f[r],f[n])}h=v=g=null;var L,S=function(r,n,t,e,o){3===arguments.length&&(e=Array,o=null);for(var i=new e(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),a=r-1,u=0;u<r;++u)i[u]=o;return{add:function(e){for(var u=n(e)&a,f=i[u],c=0;f!=o;){if(t(f,e))return!0;if(++c>=r)throw new Error("full hashset");f=i[u=u+1&a]}return i[u]=e,!0},has:function(e){for(var u=n(e)&a,f=i[u],c=0;f!=o;){if(t(f,e))return!0;if(++c>=r)break;f=i[u=u+1&a]}return!1},values:function(){for(var r=[],n=0,t=i.length;n<t;++n){var e=i[n];e!=o&&r.push(e)}return r}}}(1.4*y,a,t);for(e=0,o=f.length;e<o;++e)p[L=s[e]]&&S.add(f[L]);return S}function f(r,n,t,e){c(r,n,t),c(r,n,n+e),c(r,n+e,t)}function c(r,n,t){for(var e,o=n+(t---n>>1);n<o;++n,--t)e=r[n],r[n]=r[t],r[t]=e}function l(r){var n,t,e={};for(n in r)e[n]=null==(t=r[n])?{type:null}:("FeatureCollection"===t.type?s:"Feature"===t.type?h:v)(t);return e}function s(r){var n={type:"GeometryCollection",geometries:r.features.map(h)};return null!=r.bbox&&(n.bbox=r.bbox),n}function h(r){var n,t=v(r.geometry);for(n in null!=r.id&&(t.id=r.id),null!=r.bbox&&(t.bbox=r.bbox),r.properties){t.properties=r.properties;break}return t}function v(r){if(null==r)return{type:null};var n="GeometryCollection"===r.type?{type:"GeometryCollection",geometries:r.geometries.map(v)}:"Point"===r.type||"MultiPoint"===r.type?{type:r.type,coordinates:r.coordinates}:{type:r.type,arcs:r.coordinates};return null!=r.bbox&&(n.bbox=r.bbox),n}function g(e,o){var i=function(n){var t=1/0,e=1/0,o=-1/0,i=-1/0;function a(n){null!=n&&r.call(u,n.type)&&u[n.type](n)}var u={GeometryCollection:function(r){r.geometries.forEach(a)},Point:function(r){f(r.coordinates)},MultiPoint:function(r){r.coordinates.forEach(f)},LineString:function(r){c(r.arcs)},MultiLineString:function(r){r.arcs.forEach(c)},Polygon:function(r){r.arcs.forEach(c)},MultiPolygon:function(r){r.arcs.forEach(l)}};function f(r){var n=r[0],a=r[1];n<t&&(t=n),n>o&&(o=n),a<e&&(e=a),a>i&&(i=a)}function c(r){r.forEach(f)}function l(r){r.forEach(c)}for(var s in n)a(n[s]);return o>=t&&i>=e?[t,e,o,i]:void 0}(e=l(e)),c=function(r){var e,o,i,u,f=r.coordinates,c=r.lines,l=r.rings,s=c.length+l.length;for(delete r.lines,delete r.rings,i=0,u=c.length;i<u;++i)for(e=c[i];e=e.next;)++s;for(i=0,u=l.length;i<u;++i)for(o=l[i];o=o.next;)++s;var h=n(2*s*1.4,a,t),v=r.arcs=[];for(i=0,u=c.length;i<u;++i){e=c[i];do{g(e)}while(e=e.next)}for(i=0,u=l.length;i<u;++i)if((o=l[i]).next)do{g(o)}while(o=o.next);else p(o);function g(r){var n,t,e,o,i,a,u,c;if(e=h.get(n=f[r[0]]))for(u=0,c=e.length;u<c;++u)if(y(o=e[u],r))return r[0]=o[0],void(r[1]=o[1]);if(i=h.get(t=f[r[1]]))for(u=0,c=i.length;u<c;++u)if(d(a=i[u],r))return r[1]=a[0],void(r[0]=a[1]);e?e.push(r):h.set(n,[r]),i?i.push(r):h.set(t,[r]),v.push(r)}function p(r){var n,t,e,o,i;if(t=h.get(f[r[0]]))for(o=0,i=t.length;o<i;++o){if(m(e=t[o],r))return r[0]=e[0],void(r[1]=e[1]);if(b(e,r))return r[0]=e[1],void(r[1]=e[0])}if(t=h.get(n=f[r[0]+w(r)]))for(o=0,i=t.length;o<i;++o){if(m(e=t[o],r))return r[0]=e[0],void(r[1]=e[1]);if(b(e,r))return r[0]=e[1],void(r[1]=e[0])}t?t.push(r):h.set(n,[r]),v.push(r)}function y(r,n){var e=r[0],o=n[0],i=r[1];if(e-i!=o-n[1])return!1;for(;e<=i;++e,++o)if(!t(f[e],f[o]))return!1;return!0}function d(r,n){var e=r[0],o=n[0],i=r[1],a=n[1];if(e-i!=o-a)return!1;for(;e<=i;++e,--a)if(!t(f[e],f[a]))return!1;return!0}function m(r,n){var e=r[0],o=n[0],i=r[1]-e;if(i!==n[1]-o)return!1;for(var a=w(r),u=w(n),c=0;c<i;++c)if(!t(f[e+(c+a)%i],f[o+(c+u)%i]))return!1;return!0}function b(r,n){var e=r[0],o=n[0],i=r[1],a=n[1],u=i-e;if(u!==a-o)return!1;for(var c=w(r),l=u-w(n),s=0;s<u;++s)if(!t(f[e+(s+c)%u],f[a-(s+l)%u]))return!1;return!0}function w(r){for(var n=r[0],t=r[1],e=n,o=e,i=f[e];++e<t;){var a=f[e];(a[0]<i[0]||a[0]===i[0]&&a[1]<i[1])&&(o=e,i=a)}return o-n}return r}(function(r){var n,t,e,o=u(r),i=r.coordinates,a=r.lines,c=r.rings;for(t=0,e=a.length;t<e;++t)for(var l=a[t],s=l[0],h=l[1];++s<h;)o.has(i[s])&&(n={0:s,1:l[1]},l[1]=s,l=l.next=n);for(t=0,e=c.length;t<e;++t)for(var v=c[t],g=v[0],p=g,y=v[1],d=o.has(i[g]);++p<y;)o.has(i[p])&&(d?(n={0:p,1:v[1]},v[1]=p,v=v.next=n):(f(i,g,y,y-p),i[y]=i[g],d=!0,p=g));return r}(function(n){var t=-1,e=[],o=[],i=[];function a(n){n&&r.call(u,n.type)&&u[n.type](n)}var u={GeometryCollection:function(r){r.geometries.forEach(a)},LineString:function(r){r.arcs=f(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(f)},Polygon:function(r){r.arcs=r.arcs.map(c)},MultiPolygon:function(r){r.arcs=r.arcs.map(l)}};function f(r){for(var n=0,o=r.length;n<o;++n)i[++t]=r[n];var a={0:t-o+1,1:t};return e.push(a),a}function c(r){for(var n=0,e=r.length;n<e;++n)i[++t]=r[n];var a={0:t-e+1,1:t};return o.push(a),a}function l(r){return r.map(c)}for(var s in n)a(n[s]);return{type:"Topology",coordinates:i,lines:e,rings:o,objects:n}}(e))),s=c.coordinates,h=n(1.4*c.arcs.length,p,y);function v(n){n&&r.call(g,n.type)&&g[n.type](n)}e=c.objects,c.bbox=i,c.arcs=c.arcs.map((function(r,n){return h.set(r,n),s.slice(r[0],r[1]+1)})),delete c.coordinates,s=null;var g={GeometryCollection:function(r){r.geometries.forEach(v)},LineString:function(r){r.arcs=d(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(d)},Polygon:function(r){r.arcs=r.arcs.map(d)},MultiPolygon:function(r){r.arcs=r.arcs.map(m)}};function d(r){var n=[];do{var t=h.get(r);n.push(r[0]<r[1]?t:~t)}while(r=r.next);return n}function m(r){return r.map(d)}for(var b in e)v(e[b]);return c}function p(r){var n,t=r[0],e=r[1];return e<t&&(n=t,t=e,e=n),t+31*e}function y(r,n){var t,e=r[0],o=r[1],i=n[0],a=n[1];return o<e&&(t=e,e=o,o=t),a<i&&(t=i,i=a,a=t),e===i&&o===a}export{g as t};
