var K=Object.prototype.hasOwnProperty;function J(e){var r=1/0,i=1/0,f=-1/0,o=-1/0;function a(n){n!=null&&K.call(u,n.type)&&u[n.type](n)}var u={GeometryCollection:function(n){n.geometries.forEach(a)},Point:function(n){l(n.coordinates)},MultiPoint:function(n){n.coordinates.forEach(l)},LineString:function(n){h(n.arcs)},MultiLineString:function(n){n.arcs.forEach(h)},Polygon:function(n){n.arcs.forEach(h)},MultiPolygon:function(n){n.arcs.forEach(b)}};function l(n){var s=n[0],c=n[1];s<r&&(r=s),s>f&&(f=s),c<i&&(i=c),c>o&&(o=c)}function h(n){n.forEach(l)}function b(n){n.forEach(h)}for(var x in e)a(e[x]);return f>=r&&o>=i?[r,i,f,o]:void 0}function Q(e,r,i,f,o){arguments.length===3&&(f=Array,o=null);for(var a=new f(e=1<<Math.max(4,Math.ceil(Math.log(e)/Math.LN2))),u=e-1,l=0;l<e;++l)a[l]=o;function h(n){for(var s=r(n)&u,c=a[s],v=0;c!=o;){if(i(c,n))return!0;if(++v>=e)throw new Error("full hashset");c=a[s=s+1&u]}return a[s]=n,!0}function b(n){for(var s=r(n)&u,c=a[s],v=0;c!=o;){if(i(c,n))return!0;if(++v>=e)break;c=a[s=s+1&u]}return!1}function x(){for(var n=[],s=0,c=a.length;s<c;++s){var v=a[s];v!=o&&n.push(v)}return n}return{add:h,has:b,values:x}}function N(e,r,i,f,o,a){arguments.length===3&&(f=a=Array,o=null);for(var u=new f(e=1<<Math.max(4,Math.ceil(Math.log(e)/Math.LN2))),l=new a(e),h=e-1,b=0;b<e;++b)u[b]=o;function x(v,L){for(var m=r(v)&h,A=u[m],t=0;A!=o;){if(i(A,v))return l[m]=L;if(++t>=e)throw new Error("full hashmap");A=u[m=m+1&h]}return u[m]=v,l[m]=L,L}function n(v,L){for(var m=r(v)&h,A=u[m],t=0;A!=o;){if(i(A,v))return l[m];if(++t>=e)throw new Error("full hashmap");A=u[m=m+1&h]}return u[m]=v,l[m]=L,L}function s(v,L){for(var m=r(v)&h,A=u[m],t=0;A!=o;){if(i(A,v))return l[m];if(++t>=e)break;A=u[m=m+1&h]}return L}function c(){for(var v=[],L=0,m=u.length;L<m;++L){var A=u[L];A!=o&&v.push(A)}return v}return{set:x,maybeSet:n,get:s,keys:c}}function q(e,r){return e[0]===r[0]&&e[1]===r[1]}var D=new ArrayBuffer(16),U=new Float64Array(D),O=new Uint32Array(D);function F(e){U[0]=e[0],U[1]=e[1];var r=O[0]^O[1];return r=r<<5^r>>7^O[2]^O[3],r&2147483647}function V(e){var r=e.coordinates,i=e.lines,f=e.rings,o=w(),a=new Int32Array(r.length),u=new Int32Array(r.length),l=new Int32Array(r.length),h=new Int8Array(r.length),b=0,x,n,s,c,v;for(x=0,n=r.length;x<n;++x)a[x]=u[x]=l[x]=-1;for(x=0,n=i.length;x<n;++x){var L=i[x],m=L[0],A=L[1];for(c=o[m],v=o[++m],++b,h[c]=1;++m<=A;)d(x,s=c,c=v,v=o[m]);++b,h[v]=1}for(x=0,n=r.length;x<n;++x)a[x]=-1;for(x=0,n=f.length;x<n;++x){var t=f[x],g=t[0]+1,y=t[1];for(s=o[y-1],c=o[g-1],v=o[g],d(x,s,c,v);++g<=y;)d(x,s=c,c=v,v=o[g])}function d(j,I,M,E){if(a[M]!==j){a[M]=j;var R=u[M];if(R>=0){var B=l[M];(R!==I||B!==E)&&(R!==E||B!==I)&&(++b,h[M]=1)}else u[M]=I,l[M]=E}}function w(){for(var j=N(r.length*1.4,P,p,Int32Array,-1,Int32Array),I=new Int32Array(r.length),M=0,E=r.length;M<E;++M)I[M]=j.maybeSet(M,M);return I}function P(j){return F(r[j])}function p(j,I){return q(r[j],r[I])}a=u=l=null;var G=Q(b*1.4,F,q),C;for(x=0,n=r.length;x<n;++x)h[C=o[x]]&&G.add(r[C]);return G}function W(e){var r=V(e),i=e.coordinates,f=e.lines,o=e.rings,a,u,l;for(u=0,l=f.length;u<l;++u)for(var h=f[u],b=h[0],x=h[1];++b<x;)r.has(i[b])&&(a={0:b,1:h[1]},h[1]=b,h=h.next=a);for(u=0,l=o.length;u<l;++u)for(var n=o[u],s=n[0],c=s,v=n[1],L=r.has(i[s]);++c<v;)r.has(i[c])&&(L?(a={0:c,1:n[1]},n[1]=c,n=n.next=a):(X(i,s,v,v-c),i[v]=i[s],L=!0,c=s));return e}function X(e,r,i,f){k(e,r,i),k(e,r,r+f),k(e,r+f,i)}function k(e,r,i){for(var f=r+(i---r>>1),o;r<f;++r,--i)o=e[r],e[r]=e[i],e[i]=o}function Y(e){var r=e.coordinates,i=e.lines,f,o=e.rings,a,u=i.length+o.length,l,h;for(delete e.lines,delete e.rings,l=0,h=i.length;l<h;++l)for(f=i[l];f=f.next;)++u;for(l=0,h=o.length;l<h;++l)for(a=o[l];a=a.next;)++u;var b=N(u*2*1.4,F,q),x=e.arcs=[];for(l=0,h=i.length;l<h;++l){f=i[l];do n(f);while(f=f.next)}for(l=0,h=o.length;l<h;++l)if(a=o[l],a.next)do n(a);while(a=a.next);else s(a);function n(t){var g,y,d,w,P,p,G,C;if(d=b.get(g=r[t[0]])){for(G=0,C=d.length;G<C;++G)if(w=d[G],c(w,t)){t[0]=w[0],t[1]=w[1];return}}if(P=b.get(y=r[t[1]])){for(G=0,C=P.length;G<C;++G)if(p=P[G],v(p,t)){t[1]=p[0],t[0]=p[1];return}}d?d.push(t):b.set(g,[t]),P?P.push(t):b.set(y,[t]),x.push(t)}function s(t){var g,y,d,w,P;if(y=b.get(g=r[t[0]]))for(w=0,P=y.length;w<P;++w){if(d=y[w],L(d,t)){t[0]=d[0],t[1]=d[1];return}if(m(d,t)){t[0]=d[1],t[1]=d[0];return}}if(y=b.get(g=r[t[0]+A(t)]))for(w=0,P=y.length;w<P;++w){if(d=y[w],L(d,t)){t[0]=d[0],t[1]=d[1];return}if(m(d,t)){t[0]=d[1],t[1]=d[0];return}}y?y.push(t):b.set(g,[t]),x.push(t)}function c(t,g){var y=t[0],d=g[0],w=t[1],P=g[1];if(y-w!==d-P)return!1;for(;y<=w;++y,++d)if(!q(r[y],r[d]))return!1;return!0}function v(t,g){var y=t[0],d=g[0],w=t[1],P=g[1];if(y-w!==d-P)return!1;for(;y<=w;++y,--P)if(!q(r[y],r[P]))return!1;return!0}function L(t,g){var y=t[0],d=g[0],w=t[1],P=g[1],p=w-y;if(p!==P-d)return!1;for(var G=A(t),C=A(g),j=0;j<p;++j)if(!q(r[y+(j+G)%p],r[d+(j+C)%p]))return!1;return!0}function m(t,g){var y=t[0],d=g[0],w=t[1],P=g[1],p=w-y;if(p!==P-d)return!1;for(var G=A(t),C=p-A(g),j=0;j<p;++j)if(!q(r[y+(j+G)%p],r[P-(j+C)%p]))return!1;return!0}function A(t){for(var g=t[0],y=t[1],d=g,w=d,P=r[d];++d<y;){var p=r[d];(p[0]<P[0]||p[0]===P[0]&&p[1]<P[1])&&(w=d,P=p)}return w-g}return e}function Z(e){var r=-1,i=[],f=[],o=[];function a(n){n&&K.call(u,n.type)&&u[n.type](n)}var u={GeometryCollection:function(n){n.geometries.forEach(a)},LineString:function(n){n.arcs=l(n.arcs)},MultiLineString:function(n){n.arcs=n.arcs.map(l)},Polygon:function(n){n.arcs=n.arcs.map(h)},MultiPolygon:function(n){n.arcs=n.arcs.map(b)}};function l(n){for(var s=0,c=n.length;s<c;++s)o[++r]=n[s];var v={0:r-c+1,1:r};return i.push(v),v}function h(n){for(var s=0,c=n.length;s<c;++s)o[++r]=n[s];var v={0:r-c+1,1:r};return f.push(v),v}function b(n){return n.map(h)}for(var x in e)a(e[x]);return{type:"Topology",coordinates:o,lines:i,rings:f,objects:e}}function _(e){var r={},i;for(i in e)r[i]=$(e[i]);return r}function $(e){return e==null?{type:null}:(e.type==="FeatureCollection"?S:e.type==="Feature"?H:T)(e)}function S(e){var r={type:"GeometryCollection",geometries:e.features.map(H)};return e.bbox!=null&&(r.bbox=e.bbox),r}function H(e){var r=T(e.geometry),i;e.id!=null&&(r.id=e.id),e.bbox!=null&&(r.bbox=e.bbox);for(i in e.properties){r.properties=e.properties;break}return r}function T(e){if(e==null)return{type:null};var r=e.type==="GeometryCollection"?{type:"GeometryCollection",geometries:e.geometries.map(T)}:e.type==="Point"||e.type==="MultiPoint"?{type:e.type,coordinates:e.coordinates}:{type:e.type,arcs:e.coordinates};return e.bbox!=null&&(r.bbox=e.bbox),r}function en(e,r){var i=J(e=_(e)),f=Y(W(Z(e))),o=f.coordinates,a=N(f.arcs.length*1.4,z,nn);e=f.objects,f.bbox=i,f.arcs=f.arcs.map(function(n,s){return a.set(n,s),o.slice(n[0],n[1]+1)}),delete f.coordinates,o=null;function u(n){n&&K.call(l,n.type)&&l[n.type](n)}var l={GeometryCollection:function(n){n.geometries.forEach(u)},LineString:function(n){n.arcs=h(n.arcs)},MultiLineString:function(n){n.arcs=n.arcs.map(h)},Polygon:function(n){n.arcs=n.arcs.map(h)},MultiPolygon:function(n){n.arcs=n.arcs.map(b)}};function h(n){var s=[];do{var c=a.get(n);s.push(n[0]<n[1]?c:~c)}while(n=n.next);return s}function b(n){return n.map(h)}for(var x in e)u(e[x]);return f}function z(e){var r=e[0],i=e[1],f;return i<r&&(f=r,r=i,i=f),r+31*i}function nn(e,r){var i=e[0],f=e[1],o=r[0],a=r[1],u;return f<i&&(u=i,i=f,f=u),a<o&&(u=o,o=a,a=u),i===o&&f===a}export{en as t};
