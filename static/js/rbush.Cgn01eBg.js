import{a as I}from"./@turf.MJYb71I5.js";import{q as y}from"./quickselect.cI_fw6Fh.js";class S{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!g(t,i))return n;const r=this.toBBox,s=[];for(;i;){for(let h=0;h<i.children.length;h++){const o=i.children[h],a=i.leaf?r(o):o;g(t,a)&&(i.leaf?n.push(o):X(t,a)?this._all(o,n):s.push(o))}i=s.pop()}return n}collides(t){let i=this.data;if(!g(t,i))return!1;const n=[];for(;i;){for(let r=0;r<i.children.length;r++){const s=i.children[r],h=i.leaf?this.toBBox(s):s;if(g(t,h)){if(i.leaf||X(t,h))return!0;n.push(s)}}i=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=u([]),this}remove(t,i){if(!t)return this;let n=this.data;const r=this.toBBox(t),s=[],h=[];let o,a,c;for(;n||s.length;){if(n||(n=s.pop(),a=s[s.length-1],o=h.pop(),c=!0),n.leaf){const l=w(t,n.children,i);if(l!==-1)return n.children.splice(l,1),s.push(n),this._condense(s),this}!c&&!n.leaf&&X(n,r)?(s.push(n),h.push(o),o=0,a=n,n=n.children[0]):a?(o++,n=a.children[o],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,r){const s=n-i+1;let h=this._maxEntries,o;if(s<=h)return o=u(t.slice(i,n+1)),f(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(h)),h=Math.ceil(s/Math.pow(h,r-1))),o=u([]),o.leaf=!1,o.height=r;const a=Math.ceil(s/h),c=a*Math.ceil(Math.sqrt(h));Y(t,i,n,c,this.compareMinX);for(let l=i;l<=n;l+=c){const m=Math.min(l+c-1,n);Y(t,l,m,a,this.compareMinY);for(let d=l;d<=m;d+=a){const _=Math.min(d+a-1,m);o.children.push(this._build(t,d,_,r-1))}}return f(o,this.toBBox),o}_chooseSubtree(t,i,n,r){for(;r.push(i),!(i.leaf||r.length-1===n);){let s=1/0,h=1/0,o;for(let a=0;a<i.children.length;a++){const c=i.children[a],l=M(c),m=O(t,c)-l;m<h?(h=m,s=l<s?l:s,o=c):m===h&&l<s&&(s=l,o=c)}i=o||i.children[0]}return i}_insert(t,i,n){const r=n?t:this.toBBox(t),s=[],h=this._chooseSubtree(r,this.data,i,s);for(h.children.push(t),p(h,r);i>=0&&s[i].children.length>this._maxEntries;)this._split(s,i),i--;this._adjustParentBBoxes(r,s,i)}_split(t,i){const n=t[i],r=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,r);const h=this._chooseSplitIndex(n,s,r),o=u(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,f(n,this.toBBox),f(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)}_splitRoot(t,i){this.data=u([t,i]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let r,s=1/0,h=1/0;for(let o=i;o<=n-i;o++){const a=x(t,0,o,this.toBBox),c=x(t,o,n,this.toBBox),l=j(a,c),m=M(a)+M(c);l<s?(s=l,r=o,h=m<h?m:h):l===s&&m<h&&(h=m,r=o)}return r||n-i}_chooseSplitAxis(t,i,n){const r=t.leaf?this.compareMinX:A,s=t.leaf?this.compareMinY:E,h=this._allDistMargin(t,i,n,r),o=this._allDistMargin(t,i,n,s);h<o&&t.children.sort(r)}_allDistMargin(t,i,n,r){t.children.sort(r);const s=this.toBBox,h=x(t,0,i,s),o=x(t,n-i,n,s);let a=B(h)+B(o);for(let c=i;c<n-i;c++){const l=t.children[c];p(h,t.leaf?s(l):l),a+=B(h)}for(let c=n-i-1;c>=i;c--){const l=t.children[c];p(o,t.leaf?s(l):l),a+=B(o)}return a}_adjustParentBBoxes(t,i,n){for(let r=n;r>=0;r--)p(i[r],t)}_condense(t){for(let i=t.length-1,n;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children,n.splice(n.indexOf(t[i]),1)):this.clear():f(t[i],this.toBBox)}}function w(e,t,i){if(!i)return t.indexOf(e);for(let n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function f(e,t){x(e,0,e.children.length,t,e)}function x(e,t,i,n,r){r||(r=u(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<i;s++){const h=e.children[s];p(r,e.leaf?n(h):h)}return r}function p(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function A(e,t){return e.minX-t.minX}function E(e,t){return e.minY-t.minY}function M(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function B(e){return e.maxX-e.minX+(e.maxY-e.minY)}function O(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function j(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,s-n)}function X(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function u(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y(e,t,i,n,r){const s=[t,i];for(;s.length;){if(i=s.pop(),t=s.pop(),i-t<=n)continue;const h=t+Math.ceil((i-t)/n/2)*n;y(e,h,t,i,r),s.push(t,h,h,i)}}const N=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"})),T=I(N);export{S as R,T as r};
