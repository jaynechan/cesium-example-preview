function e(e,t,o){return e<t?(o-e)/(t-e):(e-o)/(e-t)}function t(e,t,o,n){var a;return o>n&&(a=o,o=n,n=a),e<t?e<o?(o-e)/(t-e):(n-e)/(t-e):e>n?(e-n)/(e-t):(e-o)/(e-t)}function o(e,t,o,n){return e<t?(o-e)/(t-e):(e-n)/(e-t)}function n(e,t,o,n){return e<t?(n-e)/(t-e):(e-o)/(e-t)}function a(){this.successCallback=null,this.verbose=!1,this.polygons=!1,this.polygons_full=!1,this.linearRing=!0,this.noQuadTree=!1,this.noFrame=!1}function r(e,t,o,n){var a=[];return e.polygons.forEach((function(e){e.forEach((function(e){e[0]+=t,e[1]+=o})),n.linearRing&&e.push(e[0]),a.push(e)})),a}function l(e,t,o,n){return 0===o?(e+=1,t+=n[0][1]):1===o?e+=n[0][0]:2===o?t+=n[0][1]:3===o&&(e+=n[0][0],t+=1),[e,t]}function i(e,t,o){return 0===o?e++:1===o||(2===o?t++:3===o&&(e++,t++)),[e,t]}function s(e,t,o,n,a){var r=n,l=a,i=0,p=0;if(this.x=t,this.y=o,this.lowerBound=null,this.upperBound=null,this.childA=null,this.childB=null,this.childC=null,this.childD=null,1===n&&1===a)this.lowerBound=Math.min(e[o][t],e[o][t+1],e[o+1][t+1],e[o+1][t]),this.upperBound=Math.max(e[o][t],e[o][t+1],e[o+1][t+1],e[o+1][t]);else{if(n>1){for(;0!==r;)r>>=1,i++;n===1<<i-1&&i--,r=1<<i-1}if(a>1){for(;0!==l;)l>>=1,p++;a===1<<p-1&&p--,l=1<<p-1}this.childA=new s(e,t,o,r,l),this.lowerBound=this.childA.lowerBound,this.upperBound=this.childA.upperBound,n-r>0&&(this.childB=new s(e,t+r,o,n-r,l),this.lowerBound=Math.min(this.lowerBound,this.childB.lowerBound),this.upperBound=Math.max(this.upperBound,this.childB.upperBound),a-l>0&&(this.childC=new s(e,t+r,o+l,n-r,a-l),this.lowerBound=Math.min(this.lowerBound,this.childC.lowerBound),this.upperBound=Math.max(this.upperBound,this.childC.upperBound))),a-l>0&&(this.childD=new s(e,t,o+l,r,a-l),this.lowerBound=Math.min(this.lowerBound,this.childD.lowerBound),this.upperBound=Math.max(this.upperBound,this.childD.upperBound))}}function p(e){var t,o;if(!e)throw new Error("data is required");if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Error("data must be scalar field, i.e. array of arrays");if(e.length<2)throw new Error("data must contain at least two rows");if((o=e[0].length)<2)throw new Error("data must contain at least two columns");for(t=1;t<e.length;t++){if(!Array.isArray(e[t]))throw new Error("Row "+t+" is not an array");if(e[t].length!=o)throw new Error("unequal row lengths detected, please provide a regular grid")}this.data=e,this.root=new s(e,0,0,e[0].length-1,e.length-1)}function h(t,o,n){var s,h,u,g=!1,y=!1,c=null,V=null,b=null,f=null,d=null,x=[];if(!t)throw new Error("data is required");if(null==o)throw new Error("threshold is required");if(n&&"object"!=typeof n)throw new Error("options must be an object");if(s=function(t){var o,n,r,l,i;for(l=new a,t=t||{},i=Object.keys(l),o=0;o<i.length;o++)null!=(r=t[n=i[o]])&&(l[n]=r);return l.polygons_full=!l.polygons,l.interpolate=e,l}(n),t instanceof p)c=t,V=t.root,b=t.data,s.noQuadTree||(g=!0);else{if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("input is neither array of arrays nor object retrieved from 'QuadTree()'");b=t}if(Array.isArray(o)){for(y=!0,s.noQuadTree||(g=!0),h=0;h<o.length;h++)if(isNaN(+o[h]))throw new Error("threshold["+h+"] is not a number")}else{if(isNaN(+o))throw new Error("threshold must be a number or array of numbers");o=[o]}return g&&!V&&(c=new p(b),V=c.root,b=c.data),s.verbose&&s.polygons,o.forEach((function(e,t){if(d=[],s.threshold=e,s.verbose,s.polygons)if(g)V.cellsBelowThreshold(s.threshold,!0).forEach((function(e){d=d.concat(r(m(b,e.x,e.y,s),e.x,e.y,s))}));else for(u=0;u<b.length-1;++u)for(t=0;t<b[0].length-1;++t)d=d.concat(r(m(b,t,u,s),t,u,s));else{for(f=[],t=0;t<b[0].length-1;++t)f[t]=[];if(g)V.cellsBelowThreshold(s.threshold,!1).forEach((function(e){f[e.x][e.y]=m(b,e.x,e.y,s)}));else for(t=0;t<b[0].length-1;++t)for(u=0;u<b.length-1;++u)f[t][u]=m(b,t,u,s);d=function(e,t,o){var n,a,r,s,p,h,m,u,g,y,c,V,b,f,d,x=[],v=e.length-1,_=e[0].length-1,k=["right","bottom","left","top"],w=[0,-1,0,1],B=[-1,0,1,0],E={bottom:1,left:2,top:3,right:0};return o.noFrame||function(e,t){var o,n,a,r,l;for(o=!0,n=e[0].length,a=e.length,l=0;l<a;l++)if(e[l][0]>=t||e[l][n-1]>=t){o=!1;break}if(o&&(e[a-1][0]>=t||e[a-1][n-1]>=t)&&(o=!1),o)for(r=0;r<n-1;r++)if(e[0][r]>=t||e[a-1][r]>t){o=!1;break}return o}(e,o.threshold)&&(o.linearRing?x.push([[0,0],[0,v],[_,v],[_,0],[0,0]]):x.push([[0,0],[0,v],[_,v],[_,0]])),t.forEach((function(e,A){e.forEach((function(e,N){for(n=null,a=0;a<4;a++)if(n=k[a],"object"==typeof e.edges[n]){for(p=[],r=e.edges[n],h=n,m=A,u=N,g=!1,y=[A+r.path[0][0],N+r.path[0][1]],p.push(y);!g&&"object"==typeof(s=t[m][u]).edges[h];)if(r=s.edges[h],delete s.edges[h],(c=r.path[1])[0]+=m,c[1]+=u,p.push(c),h=r.move.enter,m+=r.move.x,u+=r.move.y,void 0===t[m]||void 0===t[m][u]){if(!o.linearRing)break;if(V=0,b=0,m===_?(m--,V=0):m<0?(m++,V=2):u===v?(u--,V=3):u<0&&(u++,V=1),m===A&&u===N&&V===E[n]){g=!0,h=n;break}for(;;){if(f=!1,b>4)throw new Error("Direction change counter overflow! This should never happen!");if(void 0!==t[m]&&void 0!==t[m][u]&&(s=t[m][u],d=k[V],"object"==typeof s.edges[d])){r=s.edges[d],p.push(l(m,u,V,r.path)),h=d,f=!0;break}if(f)break;if(p.push(i(m,u,V)),u+=B[V],void 0!==t[m+=w[V]]&&void 0!==t[m][u]||(0===V&&u<0||1===V&&m<0||2===V&&u===v||3===V&&m===_)&&(m-=w[V],u-=B[V],V=(V+1)%4,b++),m===A&&u===N&&V===E[n]){g=!0,h=n;break}}}!o.linearRing||p[p.length-1][0]===y[0]&&p[p.length-1][1]===y[1]||p.push(y),x.push(p)}}))})),x}(b,f,s)}y?x.push(d):x=d,"function"==typeof s.successCallback&&s.successCallback(x,e)})),x}function m(e,t,o,n){var a,r,l,i,s,p,h=0,m=e[o+1][t],u=e[o+1][t+1],g=e[o][t+1],y=e[o][t],c=n.threshold;if(!(isNaN(y)||isNaN(g)||isNaN(u)||isNaN(m))){switch(h|=m>=c?8:0,h|=u>=c?4:0,h|=g>=c?2:0,p={cval:h=+(h|=y>=c?1:0),polygons:[],edges:{},x0:y,x1:g,x2:u,x3:m},h){case 0:n.polygons&&p.polygons.push([[0,0],[0,1],[1,1],[1,0]]);break;case 15:break;case 14:a=n.interpolate(y,m,c),i=n.interpolate(y,g,c),n.polygons_full&&(p.edges.left={path:[[0,a],[i,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&p.polygons.push([[0,0],[0,a],[i,0]]);break;case 13:i=n.interpolate(y,g,c),r=n.interpolate(g,u,c),n.polygons_full&&(p.edges.bottom={path:[[i,0],[1,r]],move:{x:1,y:0,enter:"left"}}),n.polygons&&p.polygons.push([[i,0],[1,r],[1,0]]);break;case 11:r=n.interpolate(g,u,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.right={path:[[1,r],[l,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&p.polygons.push([[1,r],[l,1],[1,1]]);break;case 7:a=n.interpolate(y,m,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.top={path:[[l,1],[0,a]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&p.polygons.push([[l,1],[0,a],[0,1]]);break;case 1:a=n.interpolate(y,m,c),i=n.interpolate(y,g,c),n.polygons_full&&(p.edges.bottom={path:[[i,0],[0,a]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&p.polygons.push([[i,0],[0,a],[0,1],[1,1],[1,0]]);break;case 2:i=n.interpolate(y,g,c),r=n.interpolate(g,u,c),n.polygons_full&&(p.edges.right={path:[[1,r],[i,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&p.polygons.push([[0,0],[0,1],[1,1],[1,r],[i,0]]);break;case 4:r=n.interpolate(g,u,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.top={path:[[l,1],[1,r]],move:{x:1,y:0,enter:"left"}}),n.polygons&&p.polygons.push([[0,0],[0,1],[l,1],[1,r],[1,0]]);break;case 8:a=n.interpolate(y,m,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.left={path:[[0,a],[l,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&p.polygons.push([[0,0],[0,a],[l,1],[1,1],[1,0]]);break;case 12:a=n.interpolate(y,m,c),r=n.interpolate(g,u,c),n.polygons_full&&(p.edges.left={path:[[0,a],[1,r]],move:{x:1,y:0,enter:"left"}}),n.polygons&&p.polygons.push([[0,0],[0,a],[1,r],[1,0]]);break;case 9:i=n.interpolate(y,g,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.bottom={path:[[i,0],[l,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&p.polygons.push([[i,0],[l,1],[1,1],[1,0]]);break;case 3:a=n.interpolate(y,m,c),r=n.interpolate(g,u,c),n.polygons_full&&(p.edges.right={path:[[1,r],[0,a]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&p.polygons.push([[0,a],[0,1],[1,1],[1,r]]);break;case 6:i=n.interpolate(y,g,c),l=n.interpolate(m,u,c),n.polygons_full&&(p.edges.top={path:[[l,1],[i,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&p.polygons.push([[0,0],[0,1],[l,1],[i,0]]);break;case 10:a=n.interpolate(y,m,c),r=n.interpolate(g,u,c),i=n.interpolate(y,g,c),l=n.interpolate(m,u,c),s=(y+g+u+m)/4,n.polygons_full&&(s<c?(p.edges.left={path:[[0,a],[l,1]],move:{x:0,y:1,enter:"bottom"}},p.edges.right={path:[[1,r],[i,0]],move:{x:0,y:-1,enter:"top"}}):(p.edges.right={path:[[1,r],[l,1]],move:{x:0,y:1,enter:"bottom"}},p.edges.left={path:[[0,a],[i,0]],move:{x:0,y:-1,enter:"top"}})),n.polygons&&(s<c?p.polygons.push([[0,0],[0,a],[l,1],[1,1],[1,r],[i,0]]):(p.polygons.push([[0,0],[0,a],[i,0]]),p.polygons.push([[l,1],[1,1],[1,r]])));break;case 5:a=n.interpolate(y,m,c),r=n.interpolate(g,u,c),i=n.interpolate(y,g,c),l=n.interpolate(m,u,c),s=(y+g+u+m)/4,n.polygons_full&&(s<c?(p.edges.bottom={path:[[i,0],[0,a]],move:{x:-1,y:0,enter:"right"}},p.edges.top={path:[[l,1],[1,r]],move:{x:1,y:0,enter:"left"}}):(p.edges.top={path:[[l,1],[0,a]],move:{x:-1,y:0,enter:"right"}},p.edges.bottom={path:[[i,0],[1,r]],move:{x:1,y:0,enter:"left"}})),n.polygons&&(s<c?p.polygons.push([[0,a],[0,1],[l,1],[1,r],[1,0],[i,0]]):(p.polygons.push([[0,a],[0,1],[l,1]]),p.polygons.push([[i,0],[1,r],[1,0]])))}return p}}s.prototype.cellsInBand=function(e,t,o){var n=[];return o=void 0===o||o,this.lowerBound>t||this.upperBound<e||(this.childA||this.childB||this.childC||this.childD?(this.childA&&(n=n.concat(this.childA.cellsInBand(e,t,o))),this.childB&&(n=n.concat(this.childB.cellsInBand(e,t,o))),this.childD&&(n=n.concat(this.childD.cellsInBand(e,t,o))),this.childC&&(n=n.concat(this.childC.cellsInBand(e,t,o)))):(o||this.lowerBound<=e||this.upperBound>=t)&&n.push({x:this.x,y:this.y})),n},s.prototype.cellsBelowThreshold=function(e,t){var o=[];return t=void 0===t||t,this.lowerBound>e||(this.childA||this.childB||this.childC||this.childD?(this.childA&&(o=o.concat(this.childA.cellsBelowThreshold(e,t))),this.childB&&(o=o.concat(this.childB.cellsBelowThreshold(e,t))),this.childD&&(o=o.concat(this.childD.cellsBelowThreshold(e,t))),this.childC&&(o=o.concat(this.childC.cellsBelowThreshold(e,t)))):(t||this.upperBound>=e)&&o.push({x:this.x,y:this.y})),o};var u=function(e,t,o,n,a,r){r.polygons&&e.polygons.push([[0,0],[0,1],[1,1],[1,0]])},g=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(t,a,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,i],[l,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,i],[l,0],[0,0]])},y=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[1,i]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[l,0],[1,i],[1,0]])},c=function(e,t,o,n,a,r){var l=r.interpolate(o,n,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV);r.polygons_full&&(e.edges.rt={path:[[1,l],[i,1]],move:{x:0,y:1,enter:"br"}}),r.polygons&&e.polygons.push([[1,l],[i,1],[1,1]])},V=function(e,t,o,n,a,r){var l=r.interpolate(a,n,r.minV,r.maxV),i=r.interpolate(t,a,r.minV,r.maxV);r.polygons_full&&(e.edges.tl={path:[[l,1],[0,i]],move:{x:-1,y:0,enter:"rt"}}),r.polygons&&e.polygons.push([[0,i],[0,1],[l,1]])},b=function(e,t,o,n,a,r){var l=r.interpolate(o,n,r.minV,r.maxV),i=r.interpolate(t,a,r.minV,r.maxV);r.polygons_full&&(e.edges.rt={path:[[1,l],[0,i]],move:{x:-1,y:0,enter:"rt"}}),r.polygons&&e.polygons.push([[0,i],[0,1],[1,1],[1,l]])},f=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[i,1]],move:{x:0,y:1,enter:"br"}}),r.polygons&&e.polygons.push([[l,0],[i,1],[1,1],[1,0]])},d=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[1,i]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[1,i],[1,0]])},x=function(e,t,o,n,a,r){var l=r.interpolate(a,n,r.minV,r.maxV),i=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.tl={path:[[l,1],[i,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,1],[l,1],[i,0]])},v=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate_a(t,a,r.minV,r.maxV),p=r.interpolate_b(t,a,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[0,s]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,p],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[0,s],[0,p],[i,0]])},_=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate_a(o,n,r.minV,r.maxV),p=r.interpolate_b(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[1,p]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,s],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[1,p],[1,s],[i,0]])},k=function(e,t,o,n,a,r){var l=r.interpolate_a(a,n,r.minV,r.maxV),i=r.interpolate_b(a,n,r.minV,r.maxV),s=r.interpolate_b(o,n,r.minV,r.maxV),p=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.rb={path:[[1,p],[l,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[i,1],[1,s]],move:{x:1,y:0,enter:"lt"}}),r.polygons&&e.polygons.push([[1,p],[l,1],[i,1],[1,s]])},w=function(e,t,o,n,a,r){var l=r.interpolate_a(a,n,r.minV,r.maxV),i=r.interpolate_b(a,n,r.minV,r.maxV),s=r.interpolate_b(t,a,r.minV,r.maxV),p=r.interpolate_a(t,a,r.minV,r.maxV);r.polygons_full&&(e.edges.tr={path:[[i,1],[0,p]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,s],[l,1]],move:{x:0,y:1,enter:"bl"}}),r.polygons&&e.polygons.push([[i,1],[0,p],[0,s],[l,1]])},B=function(e,t,o,n,a,r){var l=r.interpolate_a(t,a,r.minV,r.maxV),i=r.interpolate_b(t,a,r.minV,r.maxV),s=r.interpolate_b(o,n,r.minV,r.maxV),p=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.lt={path:[[0,i],[1,s]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,p],[0,l]],move:{x:-1,y:0,enter:"rb"}}),r.polygons&&e.polygons.push([[0,l],[0,i],[1,s],[1,p]])},E=function(e,t,o,n,a,r){var l=r.interpolate_a(a,n,r.minV,r.maxV),i=r.interpolate_b(a,n,r.minV,r.maxV),s=r.interpolate_b(t,o,r.minV,r.maxV),p=r.interpolate_a(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.tr={path:[[i,1],[s,0]],move:{x:0,y:-1,enter:"tr"}},e.edges.bl={path:[[p,0],[l,1]],move:{x:0,y:1,enter:"bl"}}),r.polygons&&e.polygons.push([[p,0],[l,1],[i,1],[s,0]])},A=function(e,t,o,n,a,r){var l=r.interpolate(a,n,r.minV,r.maxV),i=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.tl={path:[[l,1],[1,i]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[0,0],[0,1],[l,1],[1,i],[1,0]])},N=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[i,1]],move:{x:0,y:1,enter:"br"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[i,1],[1,1],[1,0]])},T=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.rt={path:[[1,i],[l,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,1],[1,1],[1,i],[l,0]])},C=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[i,0],[0,l]],move:{x:-1,y:0,enter:"rt"}}),r.polygons&&e.polygons.push([[0,l],[0,1],[1,1],[1,0],[i,0]])},j=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV),s=r.interpolate_b(o,n,r.minV,r.maxV),p=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.tl={path:[[i,1],[1,s]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,p],[0,l]],move:{x:-1,y:0,enter:"rt"}}),r.polygons&&e.polygons.push([[0,l],[0,1],[i,1],[1,s],[1,p]])},D=function(e,t,o,n,a,r){var l=r.interpolate(o,n,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate_a(t,o,r.minV,r.maxV),p=r.interpolate(a,n,r.minV,r.maxV);r.polygons_full&&(e.edges.rt={path:[[1,l],[i,0]],move:{x:0,y:-1,enter:"tr"}},e.edges.bl={path:[[s,0],[p,1]],move:{x:0,y:1,enter:"br"}}),r.polygons&&e.polygons.push([[p,1],[1,1],[1,l],[i,0],[s,0]])},q=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate_a(t,a,r.minV,r.maxV),s=r.interpolate_b(t,a,r.minV,r.maxV),p=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[0,i]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,s],[1,p]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[l,0],[0,i],[0,s],[1,p],[1,0]])},M=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate_a(a,n,r.minV,r.maxV),s=r.interpolate_b(a,n,r.minV,r.maxV),p=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[i,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[s,1],[p,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[i,1],[s,1],[p,0]])},R=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV),s=r.interpolate_b(t,o,r.minV,r.maxV),p=r.interpolate_a(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[p,0],[0,l]],move:{x:-1,y:0,enter:"rt"}},e.edges.tl={path:[[i,1],[s,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[0,l],[0,1],[i,1],[s,0],[p,0]])},I=function(e,t,o,n,a,r){var l=r.interpolate_a(t,a,r.minV,r.maxV),i=r.interpolate_b(t,a,r.minV,r.maxV),s=r.interpolate(a,n,r.minV,r.maxV),p=r.interpolate(o,a,r.minV,r.maxV);r.polygons_full&&(e.edges.lt={path:[[0,i],[s,1]],move:{x:0,y:1,enter:"br"}},e.edges.rt={path:[[1,p],[0,l]],move:{x:-1,y:0,enter:"rb"}}),r.polygons&&e.polygons.push([[0,l],[0,i],[s,1],[1,1],[1,p]])},Q=function(e,t,o,n,a,r){var l=r.interpolate_a(a,n,r.minV,r.maxV),i=r.interpolate_b(a,n,r.minV,r.maxV),s=r.interpolate(o,n,r.minV,r.maxV),p=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[p,0],[l,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[i,1],[1,s]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[l,1],[i,1],[1,s],[1,0],[p,0]])},W=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate_b(o,n,r.minV,r.maxV),s=r.interpolate_a(o,n,r.minV,r.maxV),p=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[1,i]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,s],[p,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[1,i],[1,s],[p,0]])},F=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate_a(a,n,r.minV,r.maxV),s=r.interpolate_b(a,n,r.minV,r.maxV),p=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[i,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[s,1],[1,p]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[i,1],[s,1],[1,p],[1,0]])},O=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate_a(t,a,r.minV,r.maxV),s=r.interpolate_b(t,a,r.minV,r.maxV),p=r.interpolate(a,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[0,i]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,s],[p,1]],move:{x:0,y:1,enter:"br"}}),r.polygons&&e.polygons.push([[l,0],[0,i],[0,s],[p,1],[1,1],[1,0]])},L=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate(t,a,r.minV,r.maxV),p=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[0,s]],move:{x:-1,y:0,enter:"rt"}},e.edges.rt={path:[[1,p],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[0,s],[0,1],[1,1],[1,p],[i,0]])},z=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV),s=r.interpolate_b(o,n,r.minV,r.maxV),p=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.tl={path:[[i,1],[1,s]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,p],[l,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,1],[i,1],[1,s],[1,p],[l,0]])},G=function(e,t,o,n,a,r){var l=r.interpolate(t,a,r.minV,r.maxV),i=r.interpolate(a,n,r.minV,r.maxV),s=r.interpolate(o,n,r.minV,r.maxV),p=r.interpolate(t,o,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,l],[i,1]],move:{x:0,y:1,enter:"br"}},e.edges.rt={path:[[1,s],[p,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,l],[i,1],[1,1],[1,s],[p,0]])},H=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(t,a,r.minV,r.maxV),s=r.interpolate(a,n,r.minV,r.maxV),p=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[0,i]],move:{x:-1,y:0,enter:"rt"}},e.edges.tl={path:[[s,1],[1,p]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[l,0],[0,i],[0,1],[s,1],[1,p],[1,0]])},J=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate_a(t,a,r.minV,r.maxV),p=r.interpolate_b(t,a,r.minV,r.maxV),h=r.interpolate(a,n,r.minV,r.maxV),m=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[0,s]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,p],[h,1]],move:{x:0,y:1,enter:"br"}},e.edges.rt={path:[[1,m],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[0,s],[0,p],[h,1],[1,1],[1,m],[i,0]])},K=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate(t,a,r.minV,r.maxV),s=r.interpolate_a(a,n,r.minV,r.maxV),p=r.interpolate_b(a,n,r.minV,r.maxV),h=r.interpolate_b(o,n,r.minV,r.maxV),m=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.lb={path:[[0,i],[s,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[p,1],[1,h]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,m],[l,0]],move:{x:0,y:-1,enter:"tl"}}),r.polygons&&e.polygons.push([[0,0],[0,i],[s,1],[p,1],[1,h],[1,m],[l,0]])},P=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate(t,a,r.minV,r.maxV),p=r.interpolate(a,n,r.minV,r.maxV),h=r.interpolate_b(o,n,r.minV,r.maxV),m=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[0,s]],move:{x:-1,y:0,enter:"rt"}},e.edges.tl={path:[[p,1],[1,h]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,m],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[0,s],[0,1],[p,1],[1,h],[1,m],[i,0]])},S=function(e,t,o,n,a,r){var l=r.interpolate(t,o,r.minV,r.maxV),i=r.interpolate_a(t,a,r.minV,r.maxV),s=r.interpolate_b(t,a,r.minV,r.maxV),p=r.interpolate_a(a,n,r.minV,r.maxV),h=r.interpolate_b(a,n,r.minV,r.maxV),m=r.interpolate(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.br={path:[[l,0],[0,i]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,s],[p,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[h,1],[1,m]],move:{x:1,y:0,enter:"lb"}}),r.polygons&&e.polygons.push([[l,0],[0,i],[0,s],[p,1],[h,1],[1,m],[1,0]])},U=function(e,t,o,n,a,r){var l=r.interpolate_a(t,o,r.minV,r.maxV),i=r.interpolate_b(t,o,r.minV,r.maxV),s=r.interpolate_a(t,a,r.minV,r.maxV),p=r.interpolate_b(t,a,r.minV,r.maxV),h=r.interpolate_a(a,n,r.minV,r.maxV),m=r.interpolate_b(a,n,r.minV,r.maxV),u=r.interpolate_b(o,n,r.minV,r.maxV),g=r.interpolate_a(o,n,r.minV,r.maxV);r.polygons_full&&(e.edges.bl={path:[[l,0],[0,s]],move:{x:-1,y:0,enter:"rb"}},e.edges.lt={path:[[0,p],[h,1]],move:{x:0,y:1,enter:"bl"}},e.edges.tr={path:[[m,1],[1,u]],move:{x:1,y:0,enter:"lt"}},e.edges.rb={path:[[1,g],[i,0]],move:{x:0,y:-1,enter:"tr"}}),r.polygons&&e.polygons.push([[l,0],[0,s],[0,p],[h,1],[m,1],[1,u],[1,g],[i,0]])};function X(e,s,h,m){var u,g,y,c=!1,V=null,b=null,f=null,d=null,x=!1,v=[],_=[],k=[];if(!e)throw new Error("data is required");if(null==s)throw new Error("lowerBound is required");if(null==h)throw new Error("bandWidth is required");if(y=function(e){var r,l,i,s,p;for(s=new a,e=e||{},p=Object.keys(s),r=0;r<p.length;r++)null!=(i=e[l=p[r]])&&(s[l]=i);return s.polygons_full=!s.polygons,s.interpolate=t,s.interpolate_a=o,s.interpolate_b=n,s}(m),e instanceof p)V=e,b=e.root,f=e.data,y.noQuadTree||(c=!0);else{if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Error("input is neither array of arrays nor object retrieved from 'QuadTree()'");f=e}if(Array.isArray(s)){for(x=!0,y.noQuadTree||(c=!0),u=0;u<s.length;u++)if(isNaN(+s[u]))throw new Error("lowerBound["+u+"] is not a number");if(Array.isArray(h)){if(s.length!==h.length)throw new Error("lowerBound and bandWidth have unequal lengths");for(u=0;u<h.length;u++)if(isNaN(+h[u]))throw new Error("bandWidth["+u+"] is not a number")}else{if(isNaN(+h))throw new Error("bandWidth must be a number");for(v=[],u=0;u<s.length;u++)v.push(h);h=v}}else{if(isNaN(+s))throw new Error("lowerBound must be a number");if(s=[s],isNaN(+h))throw new Error("bandWidth must be a number");h=[h]}return c&&!b&&(V=new p(f),b=V.root,f=V.data),y.verbose&&y.polygons,s.forEach((function(e,t){if(_=[],y.minV=e,y.maxV=e+h[t],y.verbose,y.polygons)if(c)b.cellsInBand(y.minV,y.maxV,!0).forEach((function(e){_=_.concat(r(Z(f,e.x,e.y,y),e.x,e.y,y))}));else for(g=0;g<f.length-1;++g)for(u=0;u<f[0].length-1;++u)_=_.concat(r(Z(f,u,g,y),u,g,y));else{for(d=[],u=0;u<f[0].length-1;++u)d[u]=[];if(c)b.cellsInBand(y.minV,y.maxV,!1).forEach((function(e){d[e.x][e.y]=Z(f,e.x,e.y,y)}));else for(u=0;u<f[0].length-1;++u)for(g=0;g<f.length-1;++g)d[u][g]=Z(f,u,g,y);_=function(e,t,o){var n,a,r,s,p,h,m,u,g,y,c,V,b,f,d,x,v=[],_=e.length-1,k=e[0].length-1,w=[["rt","rb"],["br","bl"],["lb","lt"],["tl","tr"]],B=[0,-1,0,1],E=[-1,0,1,0],A=["bl","lb","lt","tl","tr","rt","rb","br"],N={bl:1,br:1,lb:2,lt:2,tl:3,tr:3,rt:0,rb:0};return function(e,t,o){var n,a,r,l,i;for(n=!0,a=e[0].length,r=e.length,i=0;i<r;i++)if(e[i][0]<t||e[i][0]>o||e[i][a-1]<t||e[i][a-1]>o){n=!1;break}if(n&&(e[r-1][0]<t||e[r-1][0]>o||e[r-1][a-1]<t||e[r-1][a-1]>o)&&(n=!1),n)for(l=0;l<a-1;l++)if(e[0][l]<t||e[0][l]>o||e[r-1][l]<t||e[r-1][l]>o){n=!1;break}return n}(e,o.minV,o.maxV)&&(o.linearRing?v.push([[0,0],[0,_],[k,_],[k,0],[0,0]]):v.push([[0,0],[0,_],[k,_],[k,0]])),t.forEach((function(e,T){e.forEach((function(e,C){for(n=null,r=0;r<8;r++)if(n=A[r],"object"==typeof e.edges[n]){for(a=[],s=e.edges[n],m=n,u=T,g=C,y=!1,c=[T+s.path[0][0],C+s.path[0][1]],a.push(c);!y&&"object"==typeof(V=t[u][g]).edges[m];)if(s=V.edges[m],delete V.edges[m],(d=s.path[1])[0]+=u,d[1]+=g,a.push(d),m=s.move.enter,u+=s.move.x,g+=s.move.y,void 0===t[u]||void 0===t[u][g]){if(b=0,f=0,u===k)u--,b=0;else if(u<0)u++,b=2;else if(g===_)g--,b=3;else{if(!(g<0))throw new Error("Left the grid somewhere in the interior!");g++,b=1}if(u===T&&g===C&&b===N[n]){y=!0,m=n;break}for(;;){if(x=!1,f>4)throw new Error("Direction change counter overflow! This should never happen!");if(void 0!==t[u]&&void 0!==t[u][g])for(V=t[u][g],p=0;p<w[b].length;p++)if(h=w[b][p],"object"==typeof V.edges[h]){s=V.edges[h],a.push(l(u,g,b,s.path)),m=h,x=!0;break}if(x)break;if(a.push(i(u,g,b)),g+=E[b],void 0!==t[u+=B[b]]&&void 0!==t[u][g]||(0===b&&g<0||1===b&&u<0||2===b&&g===_||3===b&&u===k)&&(u-=B[b],g-=E[b],b=(b+1)%4,f++),u===T&&g===C&&b===N[n]){y=!0,m=n;break}}}!o.linearRing||a[a.length-1][0]===c[0]&&a[a.length-1][1]===c[1]||a.push(c),v.push(a)}}))})),v}(f,d,y)}x?k.push(_):k=_,"function"==typeof y.successCallback&&y.successCallback(k,e,h[t])})),k}function Y(e,t,o,n,a,r){var l=(n+o+t+e)/4;return l>r?2:l<a?0:1}function Z(e,t,o,n){var a,r,l=0,i=e[o+1][t],s=e[o+1][t+1],p=e[o][t+1],h=e[o][t],m=n.minV,X=n.maxV;if(!(isNaN(h)||isNaN(p)||isNaN(s)||isNaN(i))){switch(l|=i<m?0:i>X?128:64,l|=s<m?0:s>X?32:16,l|=p<m?0:p>X?8:4,r=0,a={cval:l=+(l|=h<m?0:h>X?2:1),polygons:[],edges:{},x0:h,x1:p,x2:s,x3:i,x:t,y:o},l){case 85:u(a,h,p,s,i,n);case 0:case 170:break;case 169:g(a,h,p,s,i,n);break;case 166:y(a,h,p,s,i,n);break;case 154:c(a,h,p,s,i,n);break;case 106:V(a,h,p,s,i,n);break;case 1:g(a,h,p,s,i,n);break;case 4:y(a,h,p,s,i,n);break;case 16:c(a,h,p,s,i,n);break;case 64:V(a,h,p,s,i,n);break;case 168:v(a,h,p,s,i,n);break;case 162:_(a,h,p,s,i,n);break;case 138:k(a,h,p,s,i,n);break;case 42:w(a,h,p,s,i,n);break;case 2:v(a,h,p,s,i,n);break;case 8:_(a,h,p,s,i,n);break;case 32:k(a,h,p,s,i,n);break;case 128:w(a,h,p,s,i,n);break;case 5:d(a,h,p,s,i,n);break;case 20:f(a,h,p,s,i,n);break;case 80:b(a,h,p,s,i,n);break;case 65:x(a,h,p,s,i,n);break;case 165:d(a,h,p,s,i,n);break;case 150:f(a,h,p,s,i,n);break;case 90:b(a,h,p,s,i,n);break;case 105:x(a,h,p,s,i,n);break;case 160:B(a,h,p,s,i,n);break;case 130:E(a,h,p,s,i,n);break;case 10:B(a,h,p,s,i,n);break;case 40:E(a,h,p,s,i,n);break;case 101:A(a,h,p,s,i,n);break;case 149:N(a,h,p,s,i,n);break;case 86:C(a,h,p,s,i,n);break;case 89:T(a,h,p,s,i,n);break;case 69:A(a,h,p,s,i,n);break;case 21:N(a,h,p,s,i,n);break;case 84:C(a,h,p,s,i,n);break;case 81:T(a,h,p,s,i,n);break;case 96:j(a,h,p,s,i,n);break;case 24:D(a,h,p,s,i,n);break;case 6:q(a,h,p,s,i,n);break;case 129:M(a,h,p,s,i,n);break;case 74:j(a,h,p,s,i,n);break;case 146:D(a,h,p,s,i,n);break;case 164:q(a,h,p,s,i,n);break;case 41:M(a,h,p,s,i,n);break;case 66:R(a,h,p,s,i,n);break;case 144:I(a,h,p,s,i,n);break;case 36:Q(a,h,p,s,i,n);break;case 9:W(a,h,p,s,i,n);break;case 104:R(a,h,p,s,i,n);break;case 26:I(a,h,p,s,i,n);break;case 134:Q(a,h,p,s,i,n);break;case 161:W(a,h,p,s,i,n);break;case 37:F(a,h,p,s,i,n);break;case 148:O(a,h,p,s,i,n);break;case 82:L(a,h,p,s,i,n);break;case 73:z(a,h,p,s,i,n);break;case 133:F(a,h,p,s,i,n);break;case 22:O(a,h,p,s,i,n);break;case 88:L(a,h,p,s,i,n);break;case 97:z(a,h,p,s,i,n);break;case 145:case 25:G(a,h,p,s,i,n);break;case 70:case 100:H(a,h,p,s,i,n);break;case 17:0===(r=Y(h,p,s,i,m,X))?(g(a,h,p,s,i,n),c(a,h,p,s,i,n)):G(a,h,p,s,i,n);break;case 68:0===(r=Y(h,p,s,i,m,X))?(V(a,h,p,s,i,n),y(a,h,p,s,i,n)):H(a,h,p,s,i,n);break;case 153:2===(r=Y(h,p,s,i,m,X))?(g(a,h,p,s,i,n),c(a,h,p,s,i,n)):G(a,h,p,s,i,n);break;case 102:2===(r=Y(h,p,s,i,m,X))?(V(a,h,p,s,i,n),y(a,h,p,s,i,n)):H(a,h,p,s,i,n);break;case 152:2===(r=Y(h,p,s,i,m,X))?(c(a,h,p,s,i,n),v(a,h,p,s,i,n)):J(a,h,p,s,i,n);break;case 137:2===(r=Y(h,p,s,i,m,X))?(g(a,h,p,s,i,n),k(a,h,p,s,i,n)):K(a,h,p,s,i,n);break;case 98:2===(r=Y(h,p,s,i,m,X))?(V(a,h,p,s,i,n),_(a,h,p,s,i,n)):P(a,h,p,s,i,n);break;case 38:2===(r=Y(h,p,s,i,m,X))?(y(a,h,p,s,i,n),w(a,h,p,s,i,n)):S(a,h,p,s,i,n);break;case 18:0===(r=Y(h,p,s,i,m,X))?(c(a,h,p,s,i,n),v(a,h,p,s,i,n)):J(a,h,p,s,i,n);break;case 33:0===(r=Y(h,p,s,i,m,X))?(g(a,h,p,s,i,n),k(a,h,p,s,i,n)):K(a,h,p,s,i,n);break;case 72:0===(r=Y(h,p,s,i,m,X))?(V(a,h,p,s,i,n),_(a,h,p,s,i,n)):P(a,h,p,s,i,n);break;case 132:0===(r=Y(h,p,s,i,m,X))?(y(a,h,p,s,i,n),w(a,h,p,s,i,n)):S(a,h,p,s,i,n);break;case 136:0===(r=Y(h,p,s,i,m,X))?(w(a,h,p,s,i,n),_(a,h,p,s,i,n)):1===r?U(a,h,p,s,i,n):(v(a,h,p,s,i,n),k(a,h,p,s,i,n));break;case 34:0===(r=Y(h,p,s,i,m,X))?(v(a,h,p,s,i,n),k(a,h,p,s,i,n)):1===r?U(a,h,p,s,i,n):(w(a,h,p,s,i,n),_(a,h,p,s,i,n))}return a}}export{h as a,X as i};
